## V. בנה, צור גרסה, הרץ
### הפרד את תהליכי הבניה וההרצה

[מאגר קוד](./codebase) הופך לגרסת פרודקשיין (לא פיתוח) דרך שלושה שלבים:

* *שלב הבנייה* הינו שלב אשר הופך את הקוד לרכיב הרצה המוכר בשם *build*. על ידי שימוש בקוד בנקודת זמן מסוימת (Commit) על ידי תהליך הורדת הגרסה, שלב הבנייה מביא את כלל [התלויות](./dependencies) ומקמפל אותם ליצירת קבצי הרצה ונכסים (כגון תמונות)
* *שלב יצירת הגרסה* לוקח את התוצר של השלב הקודם ומשלב אותו עם [הקונפיגורציה](./config). *התוצר* שנוצר מכיל את קבצי ההרצה ואת הקונפיגורציה והוא מוכן להרצה מיידית בסביבת ההרצה.
* *שלב הריצה* (אשר ידוע גם בתור "runtime") מריץ את האפליקציה בסביבת ההרצה, על ידי הרצת חלק [מתהליכי התכנה](./processes) אל מול הגרסה שנבחרה.

![קוד הופך לתוצר בנייה, אשר ביחד עם הקונפיגורציה הופך לגרסה](/images/release.png)

**על פי מתודולוגיית שניים-עשר הגורמים ישנה הפרדה מובהקת בין שלב הבנייה, שלב בניית הגרסה ושלב הריצה.** לדוגמא, אין דרך לבצע שינויים בקוד בשלב הריצה, שכן אין דרך להעביר שינויים אלו חזרה לשלב הבנייה.

כלים לניהול גרסאות נותנים כלים לניהול התוצרים, במיוחד כלים לחזרה לגרסה קודמת. לדוגמא, כלי הניהול [Capistrano](https://github.com/capistrano/capistrano/wiki) שומר על הגרסאות בתתי תיקיות בשם `releases`, כאשר הגרסה הנוכחית הינה קישור (symlink) לגרסה הנוכחית. כך שפונקציית `חזרה לאחור` שלה מאוד פשוטה.

על כל גרסה להכיל מזהה ייחודי, כמו למשל תאריך הגרסה (לדוגמא `2011-04-06-20:32:17`) או מספר רץ (כמו `v100`). יש לראות גרסאות כאל פנקס לקריאה בלבלד ואין לבצע בהן שינויים. על כל שינוי ליצור גרסה חדשה.

בניות נוצרות על ידי מפתחי המערכת בכל פעם שישנו קוד חדש. מנגד, ריצה יכולה להתבצע בצורה אוטומטית במצבים שונים כמו אתחול שרת או תהליך שקרס שמאותחל על ידי המערכת. לפיכך, יש לשמור כמה שפחות חלקים נעים בשלב הריצה מאחר ובעיות אשר מונעות מהאפליקציה לעבוד יכולות לקרות גם באמצע הלילה כאשר אין מפתחים באופק. שלב הבנייה יכול להיות מסובך יותר שכן בעיות קוראות כאשר ישנם מפתחים והם אלו אשר החלו את התהליך.