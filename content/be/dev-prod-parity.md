## X. Парытэт паміж асяроддзем распрацоўкі (dev env) і вытворчым асяроддзем (prod env)
### Трымайце асяроддзі распрацоўкі, прамежкавага асяроддзі(staging) і вытворчасці(prod) як мага больш падобнымі


Гістарычна склалася так, што існавалі істотнае прабелы паміж распрацоўкай (распрацоўшчык ўносіць бягучыя змены ў лакальна [разгорнуты](./codebase) дадатак) і асяроддзем вытворчасці (запушчаны разгортваны дадатак, доступ да якога атрымліваюць канчатковыя карыстальнікі). Гэтыя прабелы выяўляюцца ў трох абласцях:

* **Разрыў у часе**: распрацоўшчык можа працаваць над кодам, які займае дні, тыдні ці нават месяцы, перад тым каб разгарнуць дадатак на асяроддзі вытворчасці.
* **Разрыў паміж абавязкамі**: распрацоўшчыкі пішуць код, аперацыйныя інжынеры разгортваюць яго.
* **Разрыў у інструментах**: распрацоўшчыкі могуць выкарыстоўваць стэк, такі як Nginx, SQLite і OS X, у той час як разгорнуты дадатак на асяроддзі вытворчасці выкарыстоўвае Apache, MySQL і Linux.

**Дванаццаці-фактарны дадатак спраектаваны для [бесперапыннага разгортвання (continuous deployment)](http://avc.com/2011/02/continuous-deployment/), захоўваючы невялікі разрыў паміж асяроддзямі распрацоўкі і вытворчасці.** Гледзячы на тры прабелы, апісаныя вышэй:

* Зрабіце часовай разрыў невялікім: распрацоўшчык можа напісаць код і разгарнуць яго праз некалькі гадзін або нават хвілін.
* Зрабіце разрыў паміж абавязкамі невялікім: распрацоўшчыкі, якія напісалі код, цесна ўдзельнічаюць у яго разгортванні і назіраюць за яго паводзінамі ў вытворчасці.
* Зрабіце разрыў паміж інструментамі невялікім: трымайце распрацоўку і вытворчасць як мага больш падобнымі.

Сумуючы ўсё вышэйсказанае ў табліцу:

<table>
  <tr>
    <th></th>
    <th>Традыцыйныя дадаткі</th>
    <th>Дванаццаці-фактарны дадатак</th>
  </tr>
  <tr>
    <th>Час паміж разгортваннем</th>
    <td>Тыдні</td>
    <td>Часы</td>
  </tr>
  <tr>
    <th>Распрацоўшчыкі кода супраць інжэнеры по разгортванню кода</th>
    <td>Розныя людзі</td>
    <td>Адны і тыя людзі</td>
  </tr>
  <tr>
    <th>Асяроддзе распроцоўкі або вытворчасці</th>
    <td>Розныя</td>
    <td>Маскімальна падобны</td>
  </tr>
</table>

[Бэкэнд сэрвісы](./backing-services), такія як база дадзеных дадатка, сістэма, пабудаваная на базе чаргі, або кэш, з'яўляюцца адной з абласцей, дзе важная парытэт паміж dev і prod. Многія мовы распрацоўкі прапануюць бібліятэкі, якія спрашчаюць доступ да бэкэнд сэрвісаў, уключаючы *адаптары* да розных тыпаў сэрвісаў. Некаторыя дадаткі прыведзены ў табліцы ніжэй.

<table>
  <tr>
    <th>Тып</th>
    <th>Мова распрацоўкі</th>
    <th>Бібліятэка</th>
    <th>Адаптэры</th>
  </tr>
  <tr>
    <td>Database</td>
    <td>Ruby/Rails</td>
    <td>ActiveRecord</td>
    <td>MySQL, PostgreSQL, SQLite</td>
  </tr>
  <tr>
    <td>Queue</td>
    <td>Python/Django</td>
    <td>Celery</td>
    <td>RabbitMQ, Beanstalkd, Redis</td>
  </tr>
  <tr>
    <td>Cache</td>
    <td>Ruby/Rails</td>
    <td>ActiveSupport::Cache</td>
    <td>Memory, filesystem, Memcached</td>
  </tr>
</table>

Распрацоўшчыкі часам знаходзяць вялікую прывабнасць ў выкарыстанні палегчаным бэкэнд сэрвісу ў сваіх лакальных асяроддзях, у той час як больш сур'ёзны і надзейны сэрвіс падтрымкі будзе выкарыстоўвацца ў асяроддзі вытворчасці. Напрыклад, выкарыстанне SQLite лакальна і PostgreSQL ў вытворчасці; або лакальная памяць працэсу для кэшавання ў распрацоўцы і Memcached ў вытворчасці.

**Распрацоўшчык дванаццаці-фактарнага дадатка адмаўляецца ад выкарыстоўвання розных бэкэнд сэрвісаў паміж асяроддзямі распрацоўкі і вытворчасці**, нават калі адаптары тэарэтычна абстрагуюцца ад любых адрозненняў у бэкэнд сэрвісах. Адрозненні паміж бэкэнд сэрвісах азначаюць, што ўзнікаюць малюсенькія несумяшчальнасці, у выніку чаго код, які працаваў і прайшоў тэсты ў працэсе распрацоўкі або прамежкавай апрацоўкі, трывае няўдачу ў асяроддзе вытворчасці. Гэтыя тыпы памылак ствараюць трэння, якія перашкаджаюць бесперапыннаму разгортвання. Выдаткі на гэта трэнне і наступнае дэмпінг бесперапыннага разгортвання надзвычай высокія, калі разглядаць іх у сукупнасці на працягу ўсяго тэрміну жыцця дадатка.

Палегчаная (lightweight) лакальныя сэрвісы ўжо не так прывабны, як раней. Сучасныя бэкэнд сэрвісы, такія як Memcached, PostgreSQL і RabbitMQ, не ўяўляюць складанасці ва ўсталёўцы і запуску дзякуючы сучасным сістэмам упакоўкі, такім як [Homebrew](http://mxcl.github.com/homebrew/) і [apt-get](https://help.ubuntu.com/community/AptGet/Howto). Акрамя таго, дэкларатыўныя сродкі падрыхтоўкі, такія як [Chef](http://www.opscode.com/chef/) і [Puppet](http://docs.puppetlabs.com/), у спалучэнні з палегчанымі віртуальнымі асяроддзямі, такімі як [Docker](https://www.docker.com/) і [Vagrant](http://vagrantup.com/), дазваляюць распрацоўнікам запускаць лакальныя асяроддзя, якія вельмі набліжаны да працоўных асяроддзяў. Кошт ўстаноўкі і выкарыстання гэтых сістэм невялікая ў параўнанні з перавагамі парытэту dev / prod і бесперапыннага разгортвання.

Адаптары да розных бэкэнд сэрвісаў па-ранейшаму карысныя, паколькі яны робяць перанос на новыя бэкэнд сэрвісы адносна бязбольным. Але ўсе асяроддзі разгортвання дадатка (асяроддзя распрацоўніка, прамежкавыя асяроддзі, вытворчыя асяроддзі) павінны выкарыстоўваць адзін і той жа тып і версію кожнай з бэкэнд сэрвісаў.
